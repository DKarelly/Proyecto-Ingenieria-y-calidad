<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Recepcionista - Clínica Unión</title>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Tailwind CSS compilado -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
    
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 20
        }
        .material-symbols-outlined.filled {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 20
        }
        
        /* Animación para el desglose de tiempo */
        .time-breakdown {
            animation: expandIn 0.2s ease-out;
            transform-origin: top;
        }

        @keyframes expandIn {
            from {
                opacity: 0;
                transform: scaleY(0.8);
            }
            to {
                opacity: 1;
                transform: scaleY(1);
            }
        }

        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .expandable-content.expanded {
            max-height: 600px;
        }

        .rotate-180 {
            transform: rotate(180deg);
        }
    </style>
    <script>
        // Configuración personalizada (si es necesaria)
        const customConfig = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#06B6D4',
                            light: '#E0F9FC',
                            dark: '#0891B2'
                        },
                        medical: {
                            cyan: '#06B6D4',
                            teal: '#14B8A6',
                            emerald: '#10B981'
                        },
                        "background-light": "#F8F9FC",
                        "background-dark": "#0A0A0A",
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#141414",
                        "border-light": "#EFF1F4",
                        "border-dark": "#2A2A2A",
                        "text-primary-light": "#1F2937",
                        "text-primary-dark": "#E5E7EB",
                        "text-secondary-light": "#6B7280",
                        "text-secondary-dark": "#9CA3AF",
                    },
                    fontFamily: {
                        display: ["Sora", "sans-serif"],
                        body: ["Inter", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                        lg: "1rem",
                        xl: "1.5rem"
                    },
                    boxShadow: {
                        'subtle': '0 4px 6px -1px rgba(0, 0, 0, 0.03), 0 2px 4px -2px rgba(0, 0, 0, 0.03)',
                        'subtle-hover': '0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -4px rgba(0, 0, 0, 0.05)',
                        'medical': '0 10px 25px -5px rgba(6, 182, 212, 0.15)'
                    }
                },
            },
        };

        window.seleccionarPaciente = function(id, nombreCompleto, dni) {
            // Aquí puedes implementar la lógica para seleccionar el paciente
            // Por ejemplo, mostrar detalles del paciente o rellenar un formulario
            console.log('Paciente seleccionado:', { id, nombreCompleto, dni });

            // Ocultar resultados
            document.getElementById('resultados-paciente').classList.add('hidden');

            // Mostrar mensaje de selección (puedes personalizar esto)
            alert(`Paciente seleccionado: ${nombreCompleto} (DNI: ${dni})`);
        };

        window.seleccionarPacienteParaIncidencia = function(nombreCompleto, dni) {
            const input = document.getElementById('buscar-incidencia');
            input.value = `${nombreCompleto} (DNI: ${dni})`;
            document.getElementById('resultados-incidencia').classList.add('hidden');

            // Trigger the filter
            const event = new Event('input', { bubbles: true });
            input.dispatchEvent(event);
        };
    </script>
</head>

<body class="font-body bg-background-light dark:bg-background-dark text-text-secondary-light dark:text-text-secondary-dark antialiased">
    {% include 'header_recepcionista.html' %}

    <div class="flex h-[calc(100vh-80px)]">
        <!-- Sidebar Recepcionista -->
        <aside class="w-[280px] flex-shrink-0 bg-surface-light dark:bg-surface-dark border-r border-border-light dark:border-border-dark flex flex-col">
            <nav class="flex-1 px-6 py-6 space-y-2">
                <!-- Dashboard -->
                <a href="/recepcionista/panel" class="flex items-center gap-4 px-4 py-3 text-sm font-medium rounded-xl {% if not subsistema %}bg-gradient-to-r from-cyan-50 to-teal-50 text-cyan-700 border border-cyan-200 shadow-sm{% else %}text-text-secondary-light dark:text-text-secondary-dark hover:bg-gray-50 dark:hover:bg-zinc-900/50 hover:text-text-primary-light dark:hover:text-text-primary-dark{% endif %} transition-all duration-300">
                    <span class="material-symbols-outlined text-xl {% if not subsistema %}filled{% endif %}">dashboard</span>
                    <span class="font-semibold">Dashboard</span>
                </a>

                <!-- Cuentas -->
                <div class="space-y-1">
                    <a href="/recepcionista/panel?subsistema=cuentas" class="flex items-center gap-4 px-4 py-3 text-sm font-medium rounded-xl {% if subsistema == 'cuentas' %}bg-gradient-to-r from-cyan-50 to-teal-50 text-cyan-700 border border-cyan-200 shadow-sm{% else %}text-text-secondary-light dark:text-text-secondary-dark hover:bg-gray-50 dark:hover:bg-zinc-900/50 hover:text-text-primary-light dark:hover:text-text-primary-dark{% endif %} transition-all duration-300">
                        <span class="material-symbols-outlined text-xl {% if subsistema == 'cuentas' %}filled{% endif %}">account_circle</span>
                        <span class="font-semibold">Cuentas</span>
                    </a>
                    {% if subsistema == 'cuentas' %}
                    <a href="/recepcionista/panel?subsistema=cuentas&accion=registrar" class="flex items-center gap-4 px-8 py-2 text-sm font-medium rounded-lg text-cyan-600 hover:bg-cyan-50 transition-colors">
                        <span class="material-symbols-outlined text-lg">person_add</span>
                        <span>Registrar Paciente</span>
                    </a>
                    {% endif %}
                </div>

                <!-- Reserva -->
                <a href="/recepcionista/panel?subsistema=reserva" class="flex items-center gap-4 px-4 py-3 text-sm font-medium rounded-xl {% if subsistema == 'reserva' %}bg-gradient-to-r from-cyan-50 to-teal-50 text-cyan-700 border border-cyan-200 shadow-sm{% else %}text-text-secondary-light dark:text-text-secondary-dark hover:bg-gray-50 dark:hover:bg-zinc-900/50 hover:text-text-primary-light dark:hover:text-text-primary-dark{% endif %} transition-all duration-300">
                    <span class="material-symbols-outlined text-xl {% if subsistema == 'reserva' %}filled{% endif %}">event_available</span>
                    <span class="font-semibold">Reserva</span>
                </a>

                <!-- Incidencia -->
                <div class="space-y-1">
                    <a href="/recepcionista/panel?subsistema=incidencia" class="flex items-center gap-4 px-4 py-3 text-sm font-medium rounded-xl {% if subsistema == 'incidencia' %}bg-gradient-to-r from-cyan-50 to-teal-50 text-cyan-700 border border-cyan-200 shadow-sm{% else %}text-text-secondary-light dark:text-text-secondary-dark hover:bg-gray-50 dark:hover:bg-zinc-900/50 hover:text-text-primary-light dark:hover:text-text-primary-dark{% endif %} transition-all duration-300">
                        <span class="material-symbols-outlined text-xl {% if subsistema == 'incidencia' %}filled{% endif %}">report_problem</span>
                        <span class="font-semibold">Incidencia</span>
                    </a>
                    {% if subsistema == 'incidencia' %}
                    <a href="/recepcionista/panel?subsistema=incidencia&accion=generar" class="flex items-center gap-4 px-8 py-2 text-sm font-medium rounded-lg text-cyan-600 hover:bg-cyan-50 transition-colors">
                        <span class="material-symbols-outlined text-lg">add_circle</span>
                        <span>Generar Incidencia</span>
                    </a>
                    {% endif %}
                </div>
            </nav>
        </aside>

        <!-- Contenido Principal -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <main class="flex-1 overflow-y-auto p-8">
                {% if not subsistema %}
                <!-- Dashboard Principal -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Bienvenido, {{ session.get('nombre_usuario', 'Recepcionista') }}</h2>
                    <p class="text-gray-600">Aquí está tu resumen del día</p>
                </div>

                <!-- Estadísticas Rápidas -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Reservas de Hoy -->
                    <div class="bg-gradient-to-br from-cyan-500 to-cyan-600 rounded-2xl p-6 text-white shadow-medical">
                        <div class="flex items-center justify-between mb-4">
                            <span class="material-symbols-outlined text-4xl opacity-80">event</span>
                            <span class="text-3xl font-bold">{{ stats.reservas_hoy or 0 }}</span>
                        </div>
                        <h3 class="text-sm font-medium opacity-90 mb-1">Reservas de Hoy</h3>
                        <p class="text-xs opacity-75">Reservas confirmadas</p>
                    </div>

                    <!-- Pacientes Registrados -->
                    <div class="bg-gradient-to-br from-teal-500 to-teal-600 rounded-2xl p-6 text-white shadow-medical">
                        <div class="flex items-center justify-between mb-4">
                            <span class="material-symbols-outlined text-4xl opacity-80">groups</span>
                            <span class="text-3xl font-bold">{{ stats.pacientes_registrados or 0 }}</span>
                        </div>
                        <h3 class="text-sm font-medium opacity-90 mb-1">Pacientes Registrados</h3>
                        <p class="text-xs opacity-75">Esta semana</p>
                    </div>

                    <!-- Incidencias Pendientes -->
                    <div class="bg-gradient-to-br from-emerald-500 to-emerald-600 rounded-2xl p-6 text-white shadow-medical">
                        <div class="flex items-center justify-between mb-4">
                            <span class="material-symbols-outlined text-4xl opacity-80">report_problem</span>
                            <span class="text-3xl font-bold">{{ stats.incidencias_pendientes or 0 }}</span>
                        </div>
                        <h3 class="text-sm font-medium opacity-90 mb-1">Incidencias Pendientes</h3>
                        <p class="text-xs opacity-75">Requieren atención</p>
                    </div>
                </div>

                <!-- Contenido del Dashboard -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Nuevas Incidencias -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-800">Nuevas Incidencias</h3>
                            <a href="/recepcionista/panel?subsistema=incidencia" class="text-cyan-600 hover:text-cyan-700 text-sm font-semibold flex items-center gap-1">
                                Ver todas
                                <span class="material-symbols-outlined text-sm">arrow_forward</span>
                            </a>
                        </div>

                        <div class="space-y-4" id="incidencias-recientes">
                            {% if incidencias_recientes %}
                                {% for incidencia in incidencias_recientes %}
                                    <div class="flex items-center gap-4 p-4 bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-xl hover:shadow-md transition-shadow">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-orange-500 rounded-full flex items-center justify-center text-white font-bold">
                                                !
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-gray-800">{{ incidencia.nombrepaciente or 'Sin paciente asignado' }}</h4>
                                            <p class="text-sm text-gray-600">{{ incidencia.descripcion[:100] }}{% if incidencia.descripcion|length > 100 %}...{% endif %}</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="inline-block px-2 py-1 {% if incidencia.prioridad == 'Baja' %}bg-green-100 text-green-700{% elif incidencia.prioridad == 'Media' %}bg-yellow-100 text-yellow-700{% elif incidencia.prioridad == 'Alta' %}bg-red-100 text-red-700{% else %}bg-gray-100 text-gray-700{% endif %} text-xs font-semibold rounded-full mt-1">{{ incidencia.prioridad or 'Sin Prioridad' }}</span>
                                            <p class="text-xs text-gray-500 mt-1">{{ incidencia.fecha_registro.strftime('%d/%m/%Y') if incidencia.fecha_registro else 'Fecha no disponible' }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="text-center py-8 text-gray-500">
                                    <span class="material-symbols-outlined text-5xl mb-2 block text-gray-400">check_circle</span>
                                    <p class="font-medium">No hay nuevas incidencias</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Accesos Rápidos -->
                    <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-6">Accesos Rápidos</h3>

                        <div class="space-y-3">
                            <a href="/recepcionista/panel?subsistema=cuentas&accion=registrar" class="flex items-center gap-3 p-3 rounded-xl hover:bg-cyan-50 transition-colors group">
                                <div class="w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center group-hover:bg-cyan-200 transition-colors">
                                    <span class="material-symbols-outlined text-cyan-600">person_add</span>
                                </div>
                                <span class="font-semibold text-gray-700 group-hover:text-cyan-700">Registrar Paciente</span>
                            </a>

                            <a href="/recepcionista/panel?subsistema=reserva" class="flex items-center gap-3 p-3 rounded-xl hover:bg-teal-50 transition-colors group">
                                <div class="w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center group-hover:bg-teal-200 transition-colors">
                                    <span class="material-symbols-outlined text-teal-600">event_available</span>
                                </div>
                                <span class="font-semibold text-gray-700 group-hover:text-teal-700">Generar Reserva</span>
                            </a>

                            <a href="/recepcionista/panel?subsistema=incidencia&accion=generar" class="flex items-center gap-3 p-3 rounded-xl hover:bg-blue-50 transition-colors group">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center group-hover:bg-blue-200 transition-colors">
                                    <span class="material-symbols-outlined text-blue-600">add_circle</span>
                                </div>
                                <span class="font-semibold text-gray-700 group-hover:text-blue-700">Generar Incidencia</span>
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                {% if subsistema == 'cuentas' %}
                <!-- Subsistema: Cuentas -->
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Gestión de Cuentas</h2>
                    <p class="text-gray-600">Administrar cuentas de pacientes</p>
                </div>

                {% if accion == 'registrar' %}
                <!-- Formulario de Registro de Paciente -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Registrar Nueva Cuenta de Paciente</h3>
                        <p class="text-sm text-gray-600 mt-1">Complete todos los campos requeridos</p>
                    </div>

                    <form id="registro-paciente-form" class="space-y-6">
                        <!-- Nombres y Apellidos -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="nombres">
                                    <i class="fa-solid fa-user text-cyan-600"></i>
                                    Nombres <span class="text-red-500">*</span>
                                </label>
                                <input
                                    class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 placeholder-gray-400 bg-white rounded-xl transition-all hover:border-gray-300"
                                    id="nombres"
                                    name="nombres"
                                    placeholder="Ej: Juan Carlos"
                                    type="text"
                                    required
                                />
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="apellidos">
                                    <i class="fa-solid fa-user text-cyan-600"></i>
                                    Apellidos <span class="text-red-500">*</span>
                                </label>
                                <input
                                    class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 placeholder-gray-400 bg-white rounded-xl transition-all hover:border-gray-300"
                                    id="apellidos"
                                    name="apellidos"
                                    placeholder="Ej: Pérez López"
                                    type="text"
                                    required
                                />
                            </div>
                        </div>

                        <!-- Tipo de Documento y Documento de Identidad -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="tipo-documento">
                                    <i class="fa-solid fa-id-card text-cyan-600"></i>
                                    Tipo de Documento <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <select
                                        class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 bg-white rounded-xl transition-all hover:border-gray-300 appearance-none cursor-pointer"
                                        id="tipo-documento"
                                        name="tipo-documento"
                                        required
                                    >
                                        <option value="">Seleccione...</option>
                                        <option value="DNI">DNI - Documento Nacional de Identidad</option>
                                        <option value="CE">CE - Carnet de Extranjería</option>
                                        <option value="PASAPORTE">Pasaporte</option>
                                    </select>
                                    <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="documento-identidad">
                                    <i class="fa-solid fa-id-card text-cyan-600"></i>
                                    Número de Documento <span class="text-red-500">*</span>
                                </label>
                                <input
                                    class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 placeholder-gray-400 bg-white rounded-xl transition-all hover:border-gray-300"
                                    id="documento-identidad"
                                    name="documento-identidad"
                                    placeholder="Ingrese el número"
                                    type="text"
                                    inputmode="numeric"
                                    required
                                />
                                <p class="text-xs text-gray-500 mt-1 flex items-center gap-1" id="documento-hint">
                                    <i class="fa-solid fa-info-circle"></i>
                                    <span id="documento-hint-text">Seleccione el tipo de documento primero</span>
                                </p>
                            </div>
                        </div>

                        <!-- Sexo -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="sexo">
                                    <i class="fa-solid fa-venus-mars text-cyan-600"></i>
                                    Sexo <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <select
                                        class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 bg-white rounded-xl transition-all hover:border-gray-300 appearance-none cursor-pointer"
                                        id="sexo"
                                        name="sexo"
                                        required
                                    >
                                        <option value="">Seleccione...</option>
                                        <option value="Masculino">Masculino</option>
                                        <option value="Femenino">Femenino</option>
                                    </select>
                                    <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Teléfono y Fecha de Nacimiento -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="telefono">
                                    <i class="fa-solid fa-phone text-cyan-600"></i>
                                    Teléfono <span class="text-red-500">*</span>
                                </label>
                                <input
                                    class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 placeholder-gray-400 bg-white rounded-xl transition-all hover:border-gray-300"
                                    id="telefono"
                                    name="telefono"
                                    placeholder="987654321"
                                    type="tel"
                                    maxlength="9"
                                    pattern="[0-9]{9}"
                                    inputmode="numeric"
                                    required
                                />
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="fecha-nacimiento">
                                    <i class="fa-solid fa-calendar text-cyan-600"></i>
                                    Fecha de Nacimiento <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <input
                                        class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 placeholder-gray-400 bg-white rounded-xl transition-all hover:border-gray-300"
                                        id="fecha-nacimiento"
                                        name="fecha-nacimiento"
                                        type="date"
                                        required
                                    />
                                </div>
                            </div>
                        </div>

                        <!-- Correo Electrónico -->
                        <div class="space-y-2">
                            <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="email">
                                <i class="fa-solid fa-envelope text-cyan-600"></i>
                                Correo Electrónico <span class="text-red-500">*</span>
                            </label>
                            <input
                                class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 placeholder-gray-400 bg-white rounded-xl transition-all hover:border-gray-300"
                                id="email"
                                name="email"
                                placeholder="tu@email.com"
                                type="email"
                                required
                            />
                        </div>

                        <!-- Departamento, Provincia, Distrito -->
                        <div class="bg-gradient-to-br from-blue-50 to-cyan-50 p-6 rounded-2xl border-2 border-blue-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-map-location-dot text-blue-600"></i>
                                Dirección
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="space-y-2">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="departamento">
                                        <i class="fa-solid fa-city text-cyan-600"></i>
                                        Departamento <span class="text-red-500">*</span>
                                    </label>
                                    <div class="relative">
                                        <select
                                            class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 bg-white rounded-xl transition-all hover:border-gray-300 appearance-none cursor-pointer"
                                            id="departamento"
                                            name="departamento"
                                            required
                                        >
                                            <option value="">Seleccione un departamento...</option>
                                        </select>
                                        <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="provincia">
                                        <i class="fa-solid fa-building text-cyan-600"></i>
                                        Provincia <span class="text-red-500">*</span>
                                    </label>
                                    <div class="relative">
                                        <select
                                            class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 bg-white rounded-xl transition-all hover:border-gray-300 appearance-none cursor-pointer disabled:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60"
                                            id="provincia"
                                            name="provincia"
                                            required
                                            disabled
                                        >
                                            <option value="">Seleccione un departamento primero...</option>
                                        </select>
                                        <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                                <div class="space-y-2">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2" for="distrito">Distrito <span class="text-red-500">*</span></label>
                                    <div class="relative">
                                        <select
                                            class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 bg-white rounded-xl transition-all hover:border-gray-300 appearance-none cursor-pointer disabled:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60"
                                            id="distrito"
                                            name="distrito"
                                            required
                                            disabled
                                        >
                                            <option value="">Seleccione una provincia primero...</option>
                                        </select>
                                        <i class="fa-solid fa-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contraseña y Confirmar Contraseña -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="password">
                                    <i class="fa-solid fa-lock text-cyan-600"></i>
                                    Contraseña <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <input
                                        class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 placeholder-gray-400 bg-white rounded-xl transition-all hover:border-gray-300"
                                        id="password"
                                        name="password"
                                        placeholder="••••••••"
                                        type="password"
                                        minlength="6"
                                        required
                                    />
                                    <button
                                        type="button"
                                        onclick="togglePassword()"
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
                                        title="Mostrar/Ocultar contraseña"
                                    >
                                        <i class="fa-solid fa-eye" id="password-toggle-icon"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                                    <i class="fa-solid fa-info-circle"></i>
                                    Mínimo 6 caracteres
                                </p>
                            </div>
                            <div class="space-y-2">
                                <label class="block text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2" for="confirm-password">
                                    <i class="fa-solid fa-lock text-cyan-600"></i>
                                    Confirmar Contraseña <span class="text-red-500">*</span>
                                </label>
                                <div class="relative">
                                    <input
                                        class="w-full px-4 py-3 border-2 border-gray-200 focus:border-cyan-500 focus:ring-4 focus:ring-cyan-100 text-gray-700 placeholder-gray-400 bg-white rounded-xl transition-all hover:border-gray-300"
                                        id="confirm-password"
                                        name="confirm-password"
                                        placeholder="••••••••"
                                        type="password"
                                        minlength="6"
                                        required
                                    />
                                    <button
                                        type="button"
                                        onclick="toggleConfirmPassword()"
                                        class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors"
                                        title="Mostrar/Ocultar contraseña"
                                    >
                                        <i class="fa-solid fa-eye" id="confirm-password-toggle-icon"></i>
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-1 flex items-center gap-1">
                                    <i class="fa-solid fa-info-circle"></i>
                                    Debe coincidir con la contraseña
                                </p>
                            </div>
                        </div>

                        <!-- Términos y Condiciones -->
                        <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200">
                            <label class="flex items-start gap-3 cursor-pointer group">
                                <input
                                    class="mt-1 h-5 w-5 text-cyan-500 focus:ring-cyan-500 border-gray-300 rounded transition-all"
                                    id="terms"
                                    name="terms"
                                    type="checkbox"
                                    required
                                />
                                <span class="text-sm text-gray-700 group-hover:text-gray-900 transition-colors">
                                    Acepto los <a class="font-semibold text-cyan-600 hover:text-cyan-700 hover:underline" href="#">Términos y Condiciones</a> y la <a class="font-semibold text-cyan-600 hover:text-cyan-700 hover:underline" href="#">Política de Privacidad</a>
                                </span>
                            </label>
                        </div>

                        <!-- Botones -->
                        <div class="flex gap-4">
                            <button type="submit" class="flex-1 px-6 py-3 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-xl hover:from-cyan-600 hover:to-teal-600 transition-all font-semibold shadow-md">
                                <span class="material-symbols-outlined mr-2">person_add</span>
                                Registrar Paciente
                            </button>
                            <button type="button" onclick="window.location.href='/recepcionista/panel?subsistema=cuentas'" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-semibold">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>
                {% else %}
                <!-- Buscador de Pacientes -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Buscar Paciente</h3>
                    <div class="relative">
                        <input type="text" id="buscar-paciente" placeholder="Buscar por nombre o DNI..."
                               class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
                        <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">search</span>
                    </div>
                    <!-- Resultados de búsqueda -->
                    <div id="resultados-paciente" class="mt-4 space-y-2 hidden">
                        <!-- Los resultados se mostrarán aquí dinámicamente -->
                    </div>
                </div>

                <!-- Lista de Pacientes -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Lista de Pacientes</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">DNI</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Teléfono</th>
                                    <th class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-pacientes">
                                <!-- Los pacientes se cargarán aquí dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
                {% endif %}

                {% if subsistema == 'reserva' %}
                <!-- Subsistema: Reserva -->
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Sistema de Reservas</h2>
                    <p class="text-gray-600">Gestionar reservas de citas y servicios</p>
                </div>

                <!-- Aquí iría todo el contenido del sistema de reservas -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <div class="text-center py-12">
                        <span class="material-symbols-outlined text-6xl text-gray-300 mb-4 block">event_available</span>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Sistema de Reservas</h3>
                        <p class="text-gray-600">Funcionalidad completa de reservas próximamente disponible</p>
                    </div>
                </div>
                {% endif %}

                {% if subsistema == 'incidencia' %}
                <!-- Subsistema: Incidencia -->
                <div class="mb-6">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Sistema de Incidencias</h2>
                    <p class="text-gray-600">Gestionar y crear incidencias del sistema</p>
                </div>

                {% if accion == 'generar' %}
                <!-- Formulario para Generar Incidencia -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <div class="mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Generar Nueva Incidencia</h3>
                        <p class="text-sm text-gray-600 mt-1">Reportar un problema o incidencia</p>
                    </div>

                    <!-- Mensaje de éxito -->
                    <div id="mensaje-exito" class="hidden mb-6 p-4 bg-green-50 border border-green-200 rounded-xl">
                        <div class="flex items-center gap-3">
                            <span class="material-symbols-outlined text-green-600">check_circle</span>
                            <p class="text-green-800 font-semibold">Incidencia generada exitosamente</p>
                        </div>
                    </div>

                    <form id="incidencia-form" class="space-y-6">
                        <!-- Paciente (opcional) -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Paciente (opcional)
                            </label>
                            <div class="relative">
                                <input type="text" id="buscar-paciente-incidencia" placeholder="Buscar paciente por nombre o DNI..."
                                       class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
                                <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">search</span>
                                <input type="hidden" id="id_paciente" name="id_paciente">
                            </div>
                            <!-- Resultados de búsqueda -->
                            <div id="resultados-paciente-incidencia" class="mt-4 space-y-2 hidden">
                                <!-- Los resultados se mostrarán aquí dinámicamente -->
                            </div>
                        </div>

                        <!-- Tipo de Incidencia -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Tipo de Incidencia <span class="text-red-500">*</span>
                            </label>
                            <select id="tipo_incidencia" name="tipo_incidencia" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
                                <option value="">Seleccionar tipo...</option>
                                <option value="infraestructura">Infraestructura</option>
                                <option value="equipamiento_medico">Equipamiento Médico</option>
                                <option value="insumos">Insumos</option>
                                <option value="hardware">Hardware</option>
                                <option value="software">Software</option>
                                <option value="atencion_paciente">Atencion al Paciente</option>
                                <option value="otro">Otro</option>
                            </select>
                        </div>

                        <!-- Descripción -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Descripción <span class="text-red-500">*</span>
                            </label>
                            <textarea id="descripcion" name="descripcion" rows="4" required
                                      class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                                      placeholder="Describe detalladamente el problema o incidencia..."></textarea>
                        </div>

                        <!-- Prioridad -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                Prioridad <span class="text-red-500">*</span>
                            </label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="radio" name="prioridad" value="Baja" required class="mr-2">
                                    Baja
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="prioridad" value="Media" class="mr-2">
                                    Media
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="prioridad" value="Alta" class="mr-2">
                                    Alta
                                </label>
                            </div>
                        </div>

                        <!-- Botones -->
                        <div class="flex gap-4">
                            <button type="submit" class="flex-1 px-6 py-3 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-xl hover:from-cyan-600 hover:to-teal-600 transition-all font-semibold shadow-md">
                                Generar Incidencia
                            </button>
                            <button type="button" onclick="window.location.href='/recepcionista/panel?subsistema=incidencia'" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-semibold">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>
                {% else %}
                <!-- Lista de Incidencias -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
                    <!-- Barra de búsqueda -->
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text" id="buscar-incidencia" placeholder="Buscar incidencia por nombre del paciente o DNI..."
                                   class="w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-cyan-500 focus:border-transparent">
                            <span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">search</span>
                        </div>
                        <!-- Resultados de búsqueda -->
                        <div id="resultados-incidencia" class="mt-4 space-y-2 hidden">
                            <!-- Los resultados se mostrarán aquí dinámicamente -->
                        </div>
                    </div>

                    <!-- Filtros -->
                    <div class="mb-6 flex flex-wrap gap-3">
                        <button onclick="filtrarIncidencias('todas')" class="filtro-incidencia active px-4 py-2 rounded-lg text-sm font-medium">
                            Todas
                        </button>
                        <button onclick="filtrarIncidencias('progreso')" class="filtro-incidencia px-4 py-2 rounded-lg text-sm font-medium">
                            En Progreso
                        </button>
                        <button onclick="filtrarIncidencias('resuelta')" class="filtro-incidencia px-4 py-2 rounded-lg text-sm font-medium">
                            Resuelta
                        </button>
                        <button onclick="filtrarIncidencias('cerrada')" class="filtro-incidencia px-4 py-2 rounded-lg text-sm font-medium">
                            Cerradas
                        </button>
                    </div>

                    <!-- Lista de incidencias -->
                    <div class="space-y-4" id="lista-incidencias">
                        <!-- Las incidencias se cargarán dinámicamente -->
                        <div class="text-center py-8 text-gray-500">
                            <span class="material-symbols-outlined text-5xl mb-2 block text-gray-400">report_problem</span>
                            <p class="font-medium">Cargando incidencias...</p>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endif %}
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Panel Recepcionista cargado correctamente');

            // Cargar estadísticas del dashboard
            if (!window.location.search.includes('subsistema')) {
                cargarEstadisticas();
            }

            // Cargar pacientes si estamos en cuentas
            if (window.location.search.includes('subsistema=cuentas') && !window.location.search.includes('accion=registrar')) {
                cargarPacientes();
            }

            // Cargar incidencias si estamos en incidencia
            if (window.location.search.includes('subsistema=incidencia') && !window.location.search.includes('accion=generar')) {
                cargarIncidencias();
            }

            // Formulario de registro de paciente
            const registroForm = document.getElementById('registro-paciente-form');
            if (registroForm) {
                registroForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const formData = new FormData(this);

                    try {
                        const response = await fetch('/recepcionista/pacientes/registrar', {
                            method: 'POST',
                            body: formData
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert('Paciente registrado exitosamente');
                            window.location.href = '/recepcionista/panel?subsistema=cuentas';
                        } else {
                            alert('Error: ' + result.message);
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al registrar paciente');
                    }
                });
            }

            // Formulario de incidencia
            const incidenciaForm = document.getElementById('incidencia-form');
            if (incidenciaForm) {
                incidenciaForm.addEventListener('submit', async function(e) {
                    e.preventDefault();

                    const formData = new FormData(this);

                    try {
                        const response = await fetch('/recepcionista/incidencias/generar', {
                            method: 'POST',
                            body: formData
                        });

                        const result = await response.json();

                        if (result.success) {
                            // Mostrar mensaje de éxito
                            const mensajeExito = document.getElementById('mensaje-exito');
                            mensajeExito.classList.remove('hidden');
                            // Limpiar el formulario
                            incidenciaForm.reset();
                            // Ocultar el mensaje después de 5 segundos
                            setTimeout(() => {
                                mensajeExito.classList.add('hidden');
                            }, 5000);
                        } else {
                            alert('Error: ' + result.message);
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al generar incidencia');
                    }
                });
            }

            // Configurar búsqueda de pacientes
            configurarBusquedaPacientes();

            // Configurar búsqueda de pacientes para incidencias
            configurarBusquedaPacientesIncidencia();

            // Configurar búsqueda de incidencias
            configurarBusquedaIncidencias();

            // Restringir input a números para documento de identidad y teléfono (solo en formulario de registro)
            const documentoInput = document.getElementById('documento-identidad');
            if (documentoInput) {
                documentoInput.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
            }

            const telefonoInput = document.getElementById('telefono');
            if (telefonoInput) {
                telefonoInput.addEventListener('input', function(e) {
                    this.value = this.value.replace(/[^0-9]/g, '');
                });
            }

            // Cargar ubicaciones (departamentos, provincias, distritos) solo en formulario de registro
            const departamentoSelect = document.getElementById('departamento');
            if (departamentoSelect) {
                cargarDepartamentos();

                // Event listeners para cascada de ubicaciones
                departamentoSelect.addEventListener('change', function(e) {
                    const idDepartamento = e.target.value;
                    if (idDepartamento) {
                        cargarProvincias(idDepartamento);
                        document.getElementById('provincia').disabled = false;
                    } else {
                        document.getElementById('provincia').innerHTML = '<option value="">Seleccione un departamento primero...</option>';
                        document.getElementById('provincia').disabled = true;
                        document.getElementById('distrito').innerHTML = '<option value="">Seleccione una provincia primero...</option>';
                        document.getElementById('distrito').disabled = true;
                    }
                });

                document.getElementById('provincia').addEventListener('change', function(e) {
                    const idProvincia = e.target.value;
                    if (idProvincia) {
                        cargarDistritos(idProvincia);
                        document.getElementById('distrito').disabled = false;
                    } else {
                        document.getElementById('distrito').innerHTML = '<option value="">Seleccione una provincia primero...</option>';
                        document.getElementById('distrito').disabled = true;
                    }
                });
            }

            // Función para configurar la búsqueda de pacientes
            function configurarBusquedaPacientes() {
                const input = document.getElementById('buscar-paciente');
                const resultadosDiv = document.getElementById('resultados-paciente');
                let timeoutId;

                if (input) {
                    input.addEventListener('input', function(e) {
                        const termino = e.target.value.trim();

                        // Limpiar timeout anterior
                        clearTimeout(timeoutId);

                        if (termino.length < 2) {
                            resultadosDiv.classList.add('hidden');
                            resultadosDiv.innerHTML = '';
                            return;
                        }

                        // Debounce para evitar demasiadas peticiones
                        timeoutId = setTimeout(async () => {
                            try {
                                const response = await fetch(`/recepcionista/pacientes/buscar?q=${encodeURIComponent(termino)}`);
                                const pacientes = await response.json();

                                if (pacientes.length > 0) {
                                    let html = '';
                                    pacientes.forEach(paciente => {
                                        html += `
                                            <div class="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors"
                                                 onclick="seleccionarPaciente(${paciente.id_paciente}, '${paciente.nombres} ${paciente.apellidos}', '${paciente.dni}')">
                                                <div class="font-semibold text-gray-800">${paciente.nombres} ${paciente.apellidos}</div>
                                                <div class="text-sm text-gray-600">DNI: ${paciente.dni}</div>
                                            </div>
                                        `;
                                    });
                                    resultadosDiv.innerHTML = html;
                                    resultadosDiv.classList.remove('hidden');
                                } else {
                                    resultadosDiv.innerHTML = '<div class="p-3 text-gray-500 text-center">No se encontraron pacientes</div>';
                                    resultadosDiv.classList.remove('hidden');
                                }
                            } catch (error) {
                                console.error('Error buscando pacientes:', error);
                                resultadosDiv.innerHTML = '<div class="p-3 text-red-500 text-center">Error al buscar pacientes</div>';
                                resultadosDiv.classList.remove('hidden');
                            }
                        }, 300);
                    });

                    // Ocultar resultados al hacer clic fuera
                    document.addEventListener('click', function(e) {
                        if (!input.contains(e.target) && !resultadosDiv.contains(e.target)) {
                            resultadosDiv.classList.add('hidden');
                        }
                    });
                }
            }

            // Función para configurar la búsqueda de incidencias por paciente
            function configurarBusquedaIncidencias() {
                const input = document.getElementById('buscar-incidencia');
                const resultadosDiv = document.getElementById('resultados-incidencia');
                let timeoutId;

                if (input) {
                    input.addEventListener('input', function(e) {
                        const termino = e.target.value.trim();

                        // Limpiar timeout anterior
                        clearTimeout(timeoutId);

                        if (termino.length < 2) {
                            resultadosDiv.classList.add('hidden');
                            resultadosDiv.innerHTML = '';
                            return;
                        }

                        // Verificar si el término coincide con el formato de paciente seleccionado
                        const patientRegex = /.+ \(DNI: .+\)/;
                        if (patientRegex.test(termino)) {
                            resultadosDiv.classList.add('hidden');
                            resultadosDiv.innerHTML = '';
                            return;
                        }

                        // Debounce para evitar demasiadas peticiones
                        timeoutId = setTimeout(async () => {
                            try {
                                const response = await fetch(`/recepcionista/pacientes/buscar?q=${encodeURIComponent(termino)}`);
                                const pacientes = await response.json();

                                if (pacientes.length > 0) {
                                    let html = '';
                                    pacientes.forEach(paciente => {
                                        html += `
                                            <div class="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors"
                                                 onclick="seleccionarPacienteParaIncidencia('${paciente.nombres} ${paciente.apellidos}', '${paciente.dni}')">
                                                <div class="font-semibold text-gray-800">${paciente.nombres} ${paciente.apellidos}</div>
                                                <div class="text-sm text-gray-600">DNI: ${paciente.dni}</div>
                                            </div>
                                        `;
                                    });
                                    resultadosDiv.innerHTML = html;
                                    resultadosDiv.classList.remove('hidden');
                                } else {
                                    resultadosDiv.innerHTML = '<div class="p-3 text-gray-500 text-center">No se encontraron pacientes</div>';
                                    resultadosDiv.classList.remove('hidden');
                                }
                            } catch (error) {
                                console.error('Error buscando pacientes para incidencias:', error);
                                resultadosDiv.innerHTML = '<div class="p-3 text-red-500 text-center">Error al buscar pacientes</div>';
                                resultadosDiv.classList.remove('hidden');
                            }
                        }, 300);
                    });

                    // Ocultar resultados al hacer clic fuera
                    document.addEventListener('click', function(e) {
                        if (!input.contains(e.target) && !resultadosDiv.contains(e.target)) {
                            resultadosDiv.classList.add('hidden');
                        }
                    });
                }
            }

            // Búsqueda de incidencias
            const buscarIncidenciaInput = document.getElementById('buscar-incidencia');
            if (buscarIncidenciaInput) {
                buscarIncidenciaInput.addEventListener('input', function(e) {
                    const termino = e.target.value.toLowerCase();
                    const incidencias = document.querySelectorAll('#lista-incidencias > div:not(.text-center)');
                    const container = document.getElementById('lista-incidencias');

                    // Verificar si el término es un paciente seleccionado (formato: "Nombre Apellido (DNI: dni)")
                    const patientRegex = /^(.+?)\s*\(DNI:\s*(.+?)\)$/;
                    const patientMatch = termino.match(patientRegex);

                    if (patientMatch) {
                        // Si es un paciente seleccionado, filtrar por DNI exacto
                        const selectedDni = patientMatch[2].trim().toLowerCase();
                        incidencias.forEach(incidencia => {
                            const pacienteDni = (incidencia.dataset.pacienteDni || '').trim().toLowerCase();
                            if (pacienteDni === selectedDni) {
                                incidencia.style.display = '';
                            } else {
                                incidencia.style.display = 'none';
                            }
                        });
                    } else {
                        // Búsqueda normal por nombre o DNI
                        incidencias.forEach(incidencia => {
                            const pacienteNombre = (incidencia.dataset.pacienteNombre || '').toLowerCase();
                            const pacienteDni = (incidencia.dataset.pacienteDni || '').toLowerCase();

                            if (pacienteNombre.includes(termino) || pacienteDni.includes(termino)) {
                                incidencia.style.display = '';
                            } else {
                                incidencia.style.display = 'none';
                            }
                        });
                    }

                    // Mostrar mensaje si no hay resultados visibles
                    const visibleIncidencias = Array.from(incidencias).filter(inc => inc.style.display !== 'none');
                    const existingMessage = container.querySelector('.no-results-message');

                    if (visibleIncidencias.length === 0 && incidencias.length > 0) {
                        if (!existingMessage) {
                            const messageDiv = document.createElement('div');
                            messageDiv.className = 'no-results-message text-center py-8 text-gray-500';
                            messageDiv.innerHTML = `
                                <span class="material-symbols-outlined text-5xl mb-2 block text-gray-400">search_off</span>
                                <p>No se encontraron incidencias para este paciente</p>
                            `;
                            container.appendChild(messageDiv);
                        }
                    } else {
                        if (existingMessage) {
                            existingMessage.remove();
                        }
                    }
                });
            }
        });

        // Funciones para cargar datos
        async function cargarEstadisticas() {
            try {
                const response = await fetch('/recepcionista/dashboard/stats');
                const stats = await response.json();

                // Actualizar estadísticas en el DOM
                document.querySelector('.text-3xl.font-bold').textContent = stats.reservas_hoy || 0;
                // Actualizar otros stats según sea necesario
            } catch (error) {
                console.error('Error cargando estadísticas:', error);
            }
        }

        async function cargarIncidenciasRecientes() {
            try {
                const response = await fetch('/recepcionista/incidencias/recientes');
                if (!response.ok) {
                    console.error('Error en la respuesta:', response.status, response.statusText);
                    const container = document.getElementById('incidencias-recientes');
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <span class="material-symbols-outlined text-5xl mb-2 block text-red-400">error</span>
                            <p class="font-medium">Error al cargar incidencias</p>
                            <p class="text-sm text-gray-400">Revisa la consola para más detalles</p>
                        </div>
                    `;
                    return;
                }
                const incidencias = await response.json();

                const container = document.getElementById('incidencias-recientes');

                if (incidencias.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <span class="material-symbols-outlined text-5xl mb-2 block text-gray-400">check_circle</span>
                            <p class="font-medium">No hay nuevas incidencias</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                incidencias.forEach(incidencia => {
                    const prioridadClass = {
                        'Baja': 'bg-green-100 text-green-700',
                        'Media': 'bg-yellow-100 text-yellow-700',
                        'Alta': 'bg-red-100 text-red-700'
                    }[incidencia.prioridad] || 'bg-gray-100 text-gray-700';

                    const descripcionPreview = incidencia.descripcion.length > 100
                        ? incidencia.descripcion.substring(0, 100) + '...'
                        : incidencia.descripcion;

                    const fecha = new Date(incidencia.fecha_registro);
                    const fechaFormateada = isNaN(fecha.getTime()) ? 'Fecha no disponible' : fecha.toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });

                    const nombrePaciente = incidencia.nombrepaciente || 'Sin paciente asignado';

                    html += `
                        <div class="flex items-center gap-4 p-4 bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-xl hover:shadow-md transition-shadow">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-orange-500 rounded-full flex items-center justify-center text-white font-bold">
                                    !
                                </div>
                            </div>
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-800">${nombrePaciente}</h4>
                                <p class="text-sm text-gray-600">${descripcionPreview}</p>
                            </div>
                            <div class="text-right">
                                <span class="inline-block px-2 py-1 ${prioridadClass} text-xs font-semibold rounded-full mt-1">${incidencia.prioridad || 'Sin Prioridad'}</span>
                                <p class="text-xs text-gray-500 mt-1">${fechaFormateada}</p>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            } catch (error) {
                console.error('Error cargando incidencias recientes:', error);
                const container = document.getElementById('incidencias-recientes');
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <span class="material-symbols-outlined text-5xl mb-2 block text-red-400">error</span>
                        <p class="font-medium">Error de conexión</p>
                        <p class="text-sm text-gray-400">No se pudo cargar las incidencias</p>
                    </div>
                `;
            }
        }

        async function cargarPacientes() {
            try {
                const response = await fetch('/recepcionista/pacientes/listar');
                const pacientes = await response.json();

                const tbody = document.getElementById('tabla-pacientes');

                if (pacientes.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center py-8 text-gray-500">
                                <span class="material-symbols-outlined text-5xl mb-2 block text-gray-400">groups</span>
                                <p>No hay pacientes registrados</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                let html = '';
                pacientes.forEach(paciente => {
                    html += `
                        <tr class="border-b border-gray-100 paciente-row" 
                            data-nombre="${paciente.nombres} ${paciente.apellidos}" 
                            data-dni="${paciente.dni}">
                            <td class="py-4 px-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-teal-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                        ${paciente.nombres[0]}${paciente.apellidos[0]}
                                    </div>
                                    <div>
                                        <p class="font-semibold text-gray-800">${paciente.nombres} ${paciente.apellidos}</p>
                                    </div>
                                </div>
                            </td>
                            <td class="py-4 px-4 text-gray-600">${paciente.dni}</td>
                            <td class="py-4 px-4 text-gray-600">${paciente.telefono}</td>
                            <td class="py-4 px-4 text-gray-600">${paciente.email}</td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html;
            } catch (error) {
                console.error('Error cargando pacientes:', error);
            }
        }

        // Función para obtener el badge de prioridad
        function getPrioridadBadge(prioridad) {
            if (!prioridad) {
                return '<span class="bg-gray-100 text-gray-800 text-xs font-semibold px-3 py-1 rounded-full">Sin Prioridad</span>';
            }
            const badges = {
                'Baja': '<span class="bg-green-100 text-green-800 text-xs font-semibold px-3 py-1 rounded-full">Prioridad Baja</span>',
                'Media': '<span class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-3 py-1 rounded-full">Prioridad Media</span>',
                'Alta': '<span class="bg-red-100 text-red-800 text-xs font-semibold px-3 py-1 rounded-full">Prioridad Alta</span>'
            };
            return badges[prioridad] || '<span class="bg-gray-100 text-gray-800 text-xs font-semibold px-3 py-1 rounded-full">Sin Prioridad</span>';
        }

        // Función para obtener el badge de categoría
        function getCategoriaBadge(categoria) {
            if (!categoria) {
                return '';
            }
            return `<span class="bg-cyan-100 text-cyan-800 text-xs font-semibold px-3 py-1 rounded-full">${categoria}</span>`;
        }

        async function cargarIncidencias() {
            try {
                const response = await fetch('/recepcionista/incidencias/listar');
                const data = await response.json();

                if (data.error) {
                    console.error('Error al cargar incidencias:', data.error);
                    const container = document.getElementById('lista-incidencias');
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <span class="material-symbols-outlined text-5xl mb-2 block text-red-400">error</span>
                            <p>Error al cargar incidencias</p>
                        </div>
                    `;
                    return;
                }

                const incidencias = data.incidencias || [];

                const container = document.getElementById('lista-incidencias');

                if (incidencias.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 text-gray-500">
                            <span class="material-symbols-outlined text-5xl mb-2 block text-gray-400">report_problem</span>
                            <p>No hay incidencias registradas</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = incidencias.map((incidencia, index) => {
                    const fecha = new Date(incidencia.fecha_registro);
                    const fechaFormateada = isNaN(fecha.getTime()) ? 'Fecha no disponible' : fecha.toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });

                    // Determinar color del borde según prioridad
                    let borderColor = 'border-gray-200';
                    if (incidencia.prioridad === 'Alta') borderColor = 'border-red-200';
                    else if (incidencia.prioridad === 'Media') borderColor = 'border-yellow-200';
                    else if (incidencia.prioridad === 'Baja') borderColor = 'border-green-200';

                    // Truncar descripción para el preview (primeras 100 caracteres)
                    const descripcionPreview = incidencia.descripcion.length > 100
                        ? incidencia.descripcion.substring(0, 100) + '...'
                        : incidencia.descripcion;

                    return `
                        <div class="bg-white rounded-xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden border-l-4 ${borderColor}" data-estado="${incidencia.estado}" data-paciente-nombre="${incidencia.paciente_nombre || ''}" data-paciente-dni="${incidencia.dni || ''}">
                            <!-- Header del Card -->
                            <div class="bg-gradient-to-r from-cyan-50 to-cyan-100 p-6 border-b border-gray-100">
                                <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-3 mb-2 flex-wrap">
                                            <span class="bg-cyan-500 text-white text-xs font-bold px-3 py-1 rounded-full">
                                                ID: #${incidencia.id_incidencia}
                                            </span>
                                            ${getPrioridadBadge(incidencia.prioridad)}
                                            ${getCategoriaBadge(incidencia.categoria)}
                                        </div>
                                        <h3 class="text-lg font-bold text-gray-800 mb-1">${descripcionPreview}</h3>
                                        <p class="text-sm text-gray-600">${fechaFormateada}</p>
                                    </div>
                                    <button onclick="toggleExpand(${index})" class="flex items-center gap-2 bg-white text-cyan-600 font-semibold py-2 px-4 rounded-lg hover:bg-cyan-50 transition-all duration-200 border border-cyan-200">
                                        <span id="btnText-${index}">Ver Detalles</span>
                                        <svg id="chevron-${index}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="transform transition-transform duration-200">
                                            <path d="m6 9 6 6 6-6"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Información Básica (siempre visible) -->
                            <div class="p-6">
                                <div class="mb-4">
                                    <h4 class="text-sm font-semibold text-gray-500 mb-2">Paciente</h4>
                                    <p class="text-gray-700">${incidencia.paciente_nombre || 'No asignado'}</p>
                                </div>

                                <!-- Contenido Expandible -->
                                <div id="content-${index}" class="expandable-content">
                                    <div class="border-t border-gray-100 pt-4 mt-4">

                                        ${incidencia.empleado_asignado ? `
                                        <!-- Empleado Asignado -->
                                        <div class="flex items-center gap-3 mb-4 bg-blue-50 p-4 rounded-lg">
                                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600">
                                                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <p class="text-xs text-gray-500">Empleado Asignado</p>
                                                <p class="font-semibold text-gray-800">${incidencia.empleado_asignado}</p>
                                            </div>
                                        </div>
                                        ` : ''}

                                        ${incidencia.estado === 'Resuelta' || incidencia.estado === 'Cerrada' ? `
                                        <!-- Información de Resolución -->
                                        <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                                            <div class="flex items-start gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600 flex-shrink-0 mt-1">
                                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>
                                                </svg>
                                                <div class="flex-1">
                                                    <h4 class="font-bold text-gray-800 mb-2">Estado de Resolución</h4>
                                                    <p class="text-gray-700 mb-2"><span class="font-semibold">Estado:</span> ${incidencia.estado}</p>
                                                    ${incidencia.fecha_resolucion ? `<p class="text-sm text-gray-600 mb-2"><span class="font-semibold">Fecha de resolución:</span> ${new Date(incidencia.fecha_resolucion).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</p>` : ''}
                                                    ${incidencia.observaciones_resolucion ? `
                                                        <div class="mt-3 pt-3 border-t border-green-200">
                                                            <p class="font-semibold text-gray-800 mb-1">Observaciones:</p>
                                                            <p class="text-gray-700 leading-relaxed">${incidencia.observaciones_resolucion}</p>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        </div>
                                        ` : `
                                        <!-- Sin Resolución -->
                                        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
                                            <div class="flex items-start gap-3">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-yellow-600 flex-shrink-0 mt-1">
                                                    <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
                                                </svg>
                                                <div class="flex-1">
                                                    <h4 class="font-bold text-gray-800 mb-1">En Espera de Atención</h4>
                                                    <p class="text-gray-700">Esta incidencia está siendo procesada. Recibirás una notificación cuando sea atendida.</p>
                                                </div>
                                            </div>
                                        </div>
                                        `}

                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // After loading incidences, if there's a search term, apply the filter
                const buscarIncidenciaInput = document.getElementById('buscar-incidencia');
                if (buscarIncidenciaInput && buscarIncidenciaInput.value.trim()) {
                    const event = new Event('input', { bubbles: true });
                    buscarIncidenciaInput.dispatchEvent(event);
                }
            } catch (error) {
                console.error('Error cargando incidencias:', error);
                const container = document.getElementById('lista-incidencias');
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <span class="material-symbols-outlined text-5xl mb-2 block text-red-400">error</span>
                        <p>Error al cargar incidencias</p>
                    </div>
                `;
            }
        }

        // Función para expandir/contraer el contenido
        function toggleExpand(index) {
            const content = document.getElementById(`content-${index}`);
            const chevron = document.getElementById(`chevron-${index}`);
            const btnText = document.getElementById(`btnText-${index}`);

            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                chevron.classList.remove('rotate-180');
                btnText.textContent = 'Ver Detalles';
            } else {
                content.classList.add('expanded');
                chevron.classList.add('rotate-180');
                btnText.textContent = 'Ocultar Detalles';
            }
        }

        // Función para filtrar incidencias
        function filtrarIncidencias(filtro) {
            const buttons = document.querySelectorAll('.filtro-incidencia');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const incidencias = document.querySelectorAll('#lista-incidencias > div:not(.text-center)');
            incidencias.forEach(incidencia => {
                const estado = incidencia.dataset.estado;
                if (filtro === 'todas' ||
                    (filtro === 'progreso' && estado === 'En progreso') ||
                    (filtro === 'resuelta' && estado === 'Resuelta') ||
                    (filtro === 'cerrada' && estado === 'Cerrada')) {
                    incidencia.style.display = '';
                } else {
                    incidencia.style.display = 'none';
                }
            });
        }

            // Función para configurar la búsqueda de pacientes para incidencias
            function configurarBusquedaPacientesIncidencia() {
                const input = document.getElementById('buscar-paciente-incidencia');
                const resultadosDiv = document.getElementById('resultados-paciente-incidencia');
                let timeoutId;

                if (input) {
                    input.addEventListener('input', function(e) {
                        const termino = e.target.value.trim();

                        // Limpiar timeout anterior
                        clearTimeout(timeoutId);

                        if (termino.length < 2) {
                            resultadosDiv.classList.add('hidden');
                            resultadosDiv.innerHTML = '';
                            return;
                        }

                        // Debounce para evitar demasiadas peticiones
                        timeoutId = setTimeout(async () => {
                            try {
                                const response = await fetch(`/recepcionista/pacientes/buscar?q=${encodeURIComponent(termino)}`);
                                const pacientes = await response.json();

                                if (pacientes.length > 0) {
                                    let html = '';
                                    pacientes.forEach(paciente => {
                                        html += `
                                            <div class="p-3 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors"
                                                 onclick="seleccionarPacienteIncidencia('${paciente.nombres} ${paciente.apellidos}', '${paciente.dni}', ${paciente.id_paciente})">
                                                <div class="font-semibold text-gray-800">${paciente.nombres} ${paciente.apellidos}</div>
                                                <div class="text-sm text-gray-600">DNI: ${paciente.dni}</div>
                                            </div>
                                        `;
                                    });
                                    resultadosDiv.innerHTML = html;
                                    resultadosDiv.classList.remove('hidden');
                                } else {
                                    resultadosDiv.innerHTML = '<div class="p-3 text-gray-500 text-center">No se encontraron pacientes</div>';
                                    resultadosDiv.classList.remove('hidden');
                                }
                            } catch (error) {
                                console.error('Error buscando pacientes para incidencia:', error);
                                resultadosDiv.innerHTML = '<div class="p-3 text-red-500 text-center">Error al buscar pacientes</div>';
                                resultadosDiv.classList.remove('hidden');
                            }
                        }, 300);
                    });

                    // Ocultar resultados al hacer clic fuera
                    document.addEventListener('click', function(e) {
                        if (!input.contains(e.target) && !resultadosDiv.contains(e.target)) {
                            resultadosDiv.classList.add('hidden');
                        }
                    });
                }
            }


            // Función para seleccionar paciente en formulario de incidencia
            window.seleccionarPacienteIncidencia = function(nombreCompleto, dni, idPaciente) {
                const input = document.getElementById('buscar-paciente-incidencia');
                const hiddenInput = document.getElementById('id_paciente');
                input.value = `${nombreCompleto} (DNI: ${dni})`;
                hiddenInput.value = idPaciente;
                document.getElementById('resultados-paciente-incidencia').classList.add('hidden');
            };

            // Funciones para cargar ubicaciones
            async function cargarDepartamentos() {
                try {
                    const response = await fetch('/recepcionista/api/departamentos');
                    const departamentos = await response.json();

                    const select = document.getElementById('departamento');
                    select.innerHTML = '<option value="">Seleccione un departamento...</option>';

                    departamentos.forEach(departamento => {
                        const option = document.createElement('option');
                        option.value = departamento.id_departamento;
                        option.textContent = departamento.nombre;
                        select.appendChild(option);
                    });
                } catch (error) {
                    console.error('Error cargando departamentos:', error);
                }
            }

            async function cargarProvincias(idDepartamento) {
                try {
                    const response = await fetch(`/recepcionista/api/provincias/${idDepartamento}`);
                    const provincias = await response.json();

                    const select = document.getElementById('provincia');
                    select.innerHTML = '<option value="">Seleccione una provincia...</option>';

                    provincias.forEach(provincia => {
                        const option = document.createElement('option');
                        option.value = provincia.id_provincia;
                        option.textContent = provincia.nombre;
                        select.appendChild(option);
                    });
                } catch (error) {
                    console.error('Error cargando provincias:', error);
                }
            }

            async function cargarDistritos(idProvincia) {
                try {
                    const response = await fetch(`/recepcionista/api/distritos/${idProvincia}`);
                    const distritos = await response.json();

                    const select = document.getElementById('distrito');
                    select.innerHTML = '<option value="">Seleccione un distrito...</option>';

                    distritos.forEach(distrito => {
                        const option = document.createElement('option');
                        option.value = distrito.id_distrito;
                        option.textContent = distrito.nombre;
                        select.appendChild(option);
                    });
                } catch (error) {
                    console.error('Error cargando distritos:', error);
                }
            }

            // Funciones para mostrar/ocultar contraseña
            function togglePassword() {
                const input = document.getElementById('password');
                const icon = document.getElementById('password-toggle-icon');
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            }

            function toggleConfirmPassword() {
                const input = document.getElementById('confirm-password');
                const icon = document.getElementById('confirm-password-toggle-icon');
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    input.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            }
        ;
    </script>
</body>
</html>
