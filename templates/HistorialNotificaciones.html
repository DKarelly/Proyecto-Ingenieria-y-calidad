<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historial de Notificaciones</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/output.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body{font-family:'Inter',sans-serif}
        /* Estilos para notificaciones con HTML */
        .notification-message {
            line-height: 1.6;
        }
        .notification-message p {
            margin: 0.5rem 0;
        }
        .notification-message strong {
            font-weight: 600;
        }
        .notification-message div {
            margin: 0.75rem 0;
        }
        .notification-message ul, .notification-message ol {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        .notification-message li {
            margin: 0.25rem 0;
        }
    </style>
</head>
<body class="bg-gray-50">

    {% include 'header.html' %}

    <div class="container mx-auto px-4 pt-24 pb-12">
        <div class="max-w-6xl mx-auto mb-8">
            <a href="/" class="inline-flex items-center text-cyan-600 hover:text-cyan-700 mb-4">
                ‚Üê Volver al inicio
            </a>

            <div class="bg-white rounded-2xl shadow-lg p-8">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-16 h-16 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-2xl flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h6"/>
                            <path d="M7 10l5 5 5-11"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h1 class="text-3xl font-bold text-gray-800"> Historial de Notificaciones</h1>
                        <p class="text-gray-600">Aqu√≠ aparecen todas las notificaciones enviadas a tu cuenta.</p>
                    </div>
                    <div>
                        <button onclick="marcarTodasComoLeidas()" 
                                id="btn-marcar-todas"
                                class="px-4 py-2 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors font-medium flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                            Marcar todas como le√≠das
                        </button>
                    </div>
                </div>

                <div class="mt-6">
                    {% if notificaciones and notificaciones|length > 0 %}
                        <div class="space-y-3" id="historialNotificaciones">
                            {% for n in notificaciones %}
                                <div class="notificacion-item bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-200 p-4 border border-gray-100" 
                                     data-tipo="{{ n.tipo }}" 
                                     data-estado="{{ n.estado_reserva or '' }}"
                                     data-leida="{{ n.leida }}"
                                     data-id="{{ n.id_notificacion }}">
                                    <div class="flex gap-3">
                                        <!-- Icono din√°mico -->
                                        <div class="icono-notificacion flex-shrink-0"></div>
                                        
                                        <!-- Contenido -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start justify-between gap-2">
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2 mb-1">
                                                        <h3 class="font-semibold text-gray-900">{{ n.titulo }}</h3>
                                                        <span class="badge-tipo text-xs px-2 py-1 rounded-full"></span>
                                                    </div>
                                                    <div class="text-sm text-gray-600 leading-relaxed notification-message">{{ n.mensaje|safe }}</div>
                                                </div>
                                                
                                                <!-- Estado le√≠da y bot√≥n marcar como le√≠do -->
                                                <div class="flex items-center gap-2 flex-shrink-0">
                                                    {% if n.leida %}
                                                    <div class="text-green-500" title="Le√≠da">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                                        </svg>
                                                    </div>
                                                    {% else %}
                                                    <div class="flex items-center gap-2">
                                                        <span class="inline-block w-2 h-2 bg-red-500 rounded-full animate-pulse" title="No le√≠da"></span>
                                                        <button onclick="marcarComoLeida({{ n.id_notificacion }})" 
                                                                class="btn-marcar-leida text-xs px-3 py-1.5 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors font-medium flex items-center gap-1">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                                            </svg>
                                                            Marcar como le√≠da
                                                        </button>
                                                    </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-center gap-4 mt-2 text-xs text-gray-500">
                                                <span class="flex items-center gap-1">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <circle cx="12" cy="12" r="10"></circle>
                                                        <polyline points="12 6 12 12 16 14"></polyline>
                                                    </svg>
                                                    {{ n.fecha_envio }} {{ n.hora_envio }}
                                                </span>
                                                <span class="text-gray-400">‚Ä¢</span>
                                                <span>ID: #{{ n.id_notificacion }}</span>
                                                {% if n.leida and n.fecha_leida %}
                                                <span class="text-gray-400">‚Ä¢</span>
                                                <span class="text-green-600">Le√≠da: {{ n.fecha_leida.strftime('%d/%m/%Y') if n.fecha_leida else '‚Äî' }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Paginaci√≥n -->
                        {% if total_paginas > 1 %}
                        <div class="mt-6 flex items-center justify-between border-t border-gray-200 pt-6">
                            <div class="text-sm text-gray-700">
                                Mostrando <span class="font-medium">{{ ((pagina_actual - 1) * 10) + 1 }}</span> a 
                                <span class="font-medium">{{ [pagina_actual * 10, total_notificaciones]|min }}</span> de 
                                <span class="font-medium">{{ total_notificaciones }}</span> notificaciones
                            </div>
                            <div class="flex items-center gap-2">
                                {% if pagina_actual > 1 %}
                                <a href="?pagina={{ pagina_actual - 1 }}" 
                                   class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Anterior
                                </a>
                                {% endif %}
                                
                                {% for p in range(1, total_paginas + 1) %}
                                    {% if p == pagina_actual %}
                                    <span class="px-4 py-2 text-sm font-medium text-white bg-cyan-600 rounded-lg">{{ p }}</span>
                                    {% elif p <= 2 or p > total_paginas - 2 or (p >= pagina_actual - 1 and p <= pagina_actual + 1) %}
                                    <a href="?pagina={{ p }}" 
                                       class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        {{ p }}
                                    </a>
                                    {% elif p == pagina_actual - 2 or p == pagina_actual + 2 %}
                                    <span class="px-4 py-2 text-sm font-medium text-gray-500">...</span>
                                    {% endif %}
                                {% endfor %}
                                
                                {% if pagina_actual < total_paginas %}
                                <a href="?pagina={{ pagina_actual + 1 }}" 
                                   class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Siguiente
                                </a>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                    {% else %}
                        <div class="text-center py-12">
                            <svg xmlns="http://www.w3.org/2000/svg" width="72" height="72" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="mx-auto text-gray-300 mb-4">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                            <h3 class="text-xl font-semibold text-gray-800">No hay notificaciones</h3>
                            <p class="text-gray-600 mt-2">A√∫n no has recibido notificaciones.</p>
                        </div>
                    {% endif %}
                </div>

            </div>
        </div>
    </div>

    {% include 'footer.html' %}

    <script>
        // Funci√≥n para obtener estilos seg√∫n tipo y estado para el HISTORIAL
        // Nota: el header tiene su propia funci√≥n con el mismo nombre; para evitar colisiones
        // usamos un nombre distinto aqu√≠.
        function obtenerEstilosNotificacionHistorial(tipo, estadoReserva) {
            const estado = (estadoReserva || '').toString().trim().toLowerCase();
            const estilos = {
                confirmacion: {
                    borderColor: '#10b981',
                    badgeClass: 'bg-green-100 text-green-800',
                    tipoBadge: '‚úì Confirmaci√≥n',
                    icono: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>`
                },
                estado: {
                    borderColor: estado === 'completada' ? '#10b981' :
                                estado === 'pendiente' ? '#f59e0b' : 
                                estado === 'confirmada' ? '#3b82f6' : 
                                estado === 'cancelada' ? '#ef4444' : '#6b7280',
                    badgeClass: estado === 'completada' ? 'bg-green-100 text-green-800' :
                               estado === 'pendiente' ? 'bg-amber-100 text-amber-800' : 
                               estado === 'confirmada' ? 'bg-blue-100 text-blue-800' : 
                               estado === 'cancelada' ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800',
                    tipoBadge: estado === 'completada' ? '‚úì Completada' :
                              estado === 'pendiente' ? '‚óê Pendiente' : 
                              estado === 'confirmada' ? '‚óè Confirmada' : 
                              estado === 'cancelada' ? '‚úï Cancelada' : 'Estado',
                    icono: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="${estado === 'completada' ? '#10b981' : estado === 'pendiente' ? '#f59e0b' : estado === 'confirmada' ? '#3b82f6' : estado === 'cancelada' ? '#ef4444' : '#6b7280'}" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>`
                },
                recordatorio: {
                    borderColor: '#8b5cf6',
                    badgeClass: 'bg-purple-100 text-purple-800',
                    tipoBadge: 'üîî Recordatorio',
                    icono: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#8b5cf6" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>`
                },
                reprogramacion: {
                    borderColor: '#06b6d4',
                    badgeClass: 'bg-cyan-100 text-cyan-800',
                    tipoBadge: '‚Üª Reprogramaci√≥n',
                    icono: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#06b6d4" stroke-width="2">
                        <polyline points="23 4 23 10 17 10"></polyline>
                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                    </svg>`
                },
                seguridad: {
                    borderColor: '#dc2626',
                    badgeClass: 'bg-red-100 text-red-800',
                    tipoBadge: 'üîí Seguridad',
                    icono: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>`
                },
                cancelacion: {
                    borderColor: '#ef4444',
                    badgeClass: 'bg-red-100 text-red-800',
                    tipoBadge: '‚úï Cancelaci√≥n',
                    icono: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>`
                }
            };

            return estilos[tipo] || {
                borderColor: '#6b7280',
                badgeClass: 'bg-gray-100 text-gray-800',
                tipoBadge: tipo,
                icono: `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#6b7280" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>`
            };
        }

        // Funci√≥n para marcar notificaci√≥n como le√≠da (sin recargar p√°gina - optimizada)
        async function marcarComoLeida(idNotificacion) {
            // Buscar el elemento usando el atributo data-id
            const notificacionItem = document.querySelector(`.notificacion-item[data-id="${idNotificacion}"]`);
            if (!notificacionItem) {
                console.error('No se encontr√≥ la notificaci√≥n con ID:', idNotificacion);
                return;
            }
            
            // Verificar si ya est√° marcada como le√≠da
            if (notificacionItem.dataset.leida === 'True') {
                console.log('La notificaci√≥n ya est√° marcada como le√≠da');
                return;
            }
            
            const boton = notificacionItem.querySelector('button.btn-marcar-leida');
            if (!boton) {
                console.log('No se encontr√≥ el bot√≥n, la notificaci√≥n ya puede estar marcada');
                return;
            }
            
            // Buscar el contenedor padre del bot√≥n (m√°s robusto)
            const estadoDiv = boton.closest('.flex.items-center.gap-2');
            if (!estadoDiv) {
                console.error('No se encontr√≥ el contenedor del bot√≥n');
                return;
            }
            
            // Guardar referencia del HTML original para poder restaurarlo si falla
            const htmlOriginal = estadoDiv.innerHTML;
            
            // Actualizar visualmente INMEDIATAMENTE (optimistic update)
            estadoDiv.innerHTML = `
                <div class="text-green-500" title="Le√≠da">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                </div>
            `;
            
            // Actualizar opacidad
            notificacionItem.style.opacity = '0.7';
            notificacionItem.dataset.leida = 'True';
            
            // Agregar fecha de le√≠da si no existe
            const fechaContainer = notificacionItem.querySelector('.flex.items-center.gap-4.mt-2');
            if (fechaContainer) {
                const yaTieneFechaLeida = fechaContainer.querySelector('.text-green-600');
                if (!yaTieneFechaLeida) {
                    const fechaActual = new Date().toLocaleDateString('es-ES');
                    const fechaSpan = document.createElement('span');
                    fechaSpan.className = 'text-gray-400';
                    fechaSpan.textContent = '‚Ä¢';
                    fechaContainer.appendChild(fechaSpan);
                    
                    const leidaSpan = document.createElement('span');
                    leidaSpan.className = 'text-green-600';
                    leidaSpan.textContent = `Le√≠da: ${fechaActual}`;
                    fechaContainer.appendChild(leidaSpan);
                }
            }
            
            // Hacer la petici√≥n en segundo plano (sin bloquear la UI)
            try {
                const response = await fetch(`/notificaciones/api/marcar-leida/${idNotificacion}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    // Si falla, revertir cambios
                    console.error('Error al marcar como le√≠da:', data.error);
                    notificacionItem.style.opacity = '1';
                    notificacionItem.dataset.leida = 'False';
                    estadoDiv.innerHTML = htmlOriginal;
                    alert('Error al marcar la notificaci√≥n como le√≠da: ' + (data.error || 'Error desconocido'));
                }
            } catch (error) {
                console.error('Error:', error);
                // Revertir cambios si hay error
                notificacionItem.style.opacity = '1';
                notificacionItem.dataset.leida = 'False';
                estadoDiv.innerHTML = htmlOriginal;
                alert('Error al marcar la notificaci√≥n como le√≠da');
            }
        }

        // Funci√≥n para marcar todas las notificaciones como le√≠das (optimizada)
        async function marcarTodasComoLeidas() {
            const boton = document.getElementById('btn-marcar-todas');
            if (!boton) return;
            
            const textoOriginal = boton.innerHTML;
            
            // Buscar todas las notificaciones que tienen un bot√≥n "Marcar como le√≠da" (m√°s confiable)
            const todasLasNotificaciones = document.querySelectorAll('.notificacion-item');
            const notificacionesNoLeidas = Array.from(todasLasNotificaciones).filter(item => {
                const btnIndividual = item.querySelector('button.btn-marcar-leida');
                return btnIndividual !== null; // Si tiene bot√≥n, no est√° le√≠da
            });
            
            if (notificacionesNoLeidas.length === 0) {
                console.log('No hay notificaciones sin leer');
                boton.style.display = 'none';
                return;
            }
            
            const fechaActual = new Date().toLocaleDateString('es-ES');
            const cambiosOriginales = []; // Guardar estados originales para poder revertir
            
            // Actualizar visualmente INMEDIATAMENTE (optimistic update)
            notificacionesNoLeidas.forEach(item => {
                // Buscar el bot√≥n individual
                const btnIndividual = item.querySelector('button.btn-marcar-leida');
                if (!btnIndividual) return;
                
                // Buscar el contenedor del bot√≥n usando el mismo m√©todo robusto
                const estadoDiv = btnIndividual.closest('.flex.items-center.gap-2');
                if (!estadoDiv) return;
                
                // Guardar el HTML original para poder revertir si falla
                cambiosOriginales.push({
                    item: item,
                    htmlOriginal: estadoDiv.innerHTML,
                    fechaContainer: item.querySelector('.flex.items-center.gap-4.mt-2')
                });
                
                // Actualizar el estado visual
                estadoDiv.innerHTML = `
                    <div class="text-green-500" title="Le√≠da">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                    </div>
                `;
                
                // Actualizar opacidad
                item.style.opacity = '0.7';
                item.dataset.leida = 'True';
                
                // Agregar fecha de le√≠da si no existe
                const fechaContainer = item.querySelector('.flex.items-center.gap-4.mt-2');
                if (fechaContainer) {
                    const yaTieneFechaLeida = fechaContainer.querySelector('.text-green-600');
                    if (!yaTieneFechaLeida) {
                        const separador = document.createElement('span');
                        separador.className = 'text-gray-400';
                        separador.textContent = '‚Ä¢';
                        fechaContainer.appendChild(separador);
                        
                        const leidaSpan = document.createElement('span');
                        leidaSpan.className = 'text-green-600';
                        leidaSpan.textContent = `Le√≠da: ${fechaActual}`;
                        fechaContainer.appendChild(leidaSpan);
                    }
                }
            });
            
            // Ocultar bot√≥n general
            boton.style.display = 'none';
            
            // Hacer la petici√≥n en segundo plano (sin bloquear la UI)
            try {
                const response = await fetch('/notificaciones/api/marcar-todas-leidas', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    // Si falla, revertir cambios
                    console.error('Error al marcar todas como le√≠das:', data.error);
                    cambiosOriginales.forEach(cambio => {
                        cambio.item.style.opacity = '1';
                        cambio.item.dataset.leida = 'False';
                        const estadoDiv = cambio.item.querySelector('.flex.items-center.gap-2');
                        if (estadoDiv) {
                            estadoDiv.innerHTML = cambio.htmlOriginal;
                        }
                        // Remover fecha de le√≠da si se agreg√≥
                        if (cambio.fechaContainer) {
                            const fechaLeida = cambio.fechaContainer.querySelector('.text-green-600');
                            if (fechaLeida) {
                                const separador = fechaLeida.previousElementSibling;
                                if (separador && separador.classList.contains('text-gray-400')) {
                                    separador.remove();
                                }
                                fechaLeida.remove();
                            }
                        }
                    });
                    boton.style.display = 'inline-flex';
                    alert('Error al marcar todas las notificaciones como le√≠das: ' + (data.error || 'Error desconocido'));
                } else {
                    // Actualizar el badge de la campanita
                    if (typeof cargarBovedaNotificaciones === 'function') {
                        cargarBovedaNotificaciones();
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                // Revertir cambios si hay error
                cambiosOriginales.forEach(cambio => {
                    cambio.item.style.opacity = '1';
                    cambio.item.dataset.leida = 'False';
                    const estadoDiv = cambio.item.querySelector('.flex.items-center.gap-2');
                    if (estadoDiv) {
                        estadoDiv.innerHTML = cambio.htmlOriginal;
                    }
                    // Remover fecha de le√≠da si se agreg√≥
                    if (cambio.fechaContainer) {
                        const fechaLeida = cambio.fechaContainer.querySelector('.text-green-600');
                        if (fechaLeida) {
                            const separador = fechaLeida.previousElementSibling;
                            if (separador && separador.classList.contains('text-gray-400')) {
                                separador.remove();
                            }
                            fechaLeida.remove();
                        }
                    }
                });
                boton.style.display = 'inline-flex';
                alert('Error al marcar todas las notificaciones como le√≠das');
            }
        }

        // Aplicar estilos a todas las notificaciones al cargar
        document.addEventListener('DOMContentLoaded', function() {
            const items = document.querySelectorAll('.notificacion-item');
            
            items.forEach(item => {
                const tipo = item.dataset.tipo;
                const estado = item.dataset.estado;
                const leida = item.dataset.leida === 'True';
                
                const estilos = obtenerEstilosNotificacionHistorial(tipo, estado);
                
                // Aplicar borde izquierdo
                item.style.borderLeft = `4px solid ${estilos.borderColor}`;
                
                // Aplicar opacidad si est√° le√≠da
                if (leida) {
                    item.style.opacity = '0.7';
                }
                
                // Insertar icono
                const iconoContainer = item.querySelector('.icono-notificacion');
                if (iconoContainer) {
                    iconoContainer.innerHTML = estilos.icono;
                }
                
                // Insertar badge
                const badge = item.querySelector('.badge-tipo');
                if (badge) {
                    badge.className = `badge-tipo text-xs px-2 py-1 rounded-full font-medium ${estilos.badgeClass}`;
                    badge.textContent = estilos.tipoBadge;
                }
            });
        });
    </script>

</body>
</html>
